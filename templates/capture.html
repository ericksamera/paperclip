{% extends "base.html" %}
{% block title %}{{ capture.title }} Â· Paperclip{% endblock %}

{% block content %}
  <div class="panel">
    <div class="panel__title">Capture</div>
    <div class="panel__body">
      <div class="capture-head">
        <div>
          <h2 style="margin: 0 0 6px">{{ capture.title }}</h2>

          {% if authors_str %}
            <div class="muted small" style="margin: 0 0 6px">
              {{ authors_str }}
            </div>
          {% endif %}

          <div class="muted small">
            <a
              href="{{ capture.url }}"
              target="_blank"
              rel="noopener noreferrer"
            >
              {{ capture.url }}
            </a>
          </div>

          {% if meta.abstract %}
            <div style="margin-top: 10px">
              <div class="muted small" style="margin-bottom: 4px">Abstract</div>
              <div>{{ meta.abstract }}</div>
            </div>
          {% endif %}
        </div>

        <div class="capture-actions">
          <a
            class="btn"
            href="{{ url_for('export_bibtex', capture_id=capture.id) }}"
            >BibTeX</a
          >
          <a
            class="btn"
            href="{{ url_for('export_ris', capture_id=capture.id) }}"
            >RIS</a
          >

          <form
            method="post"
            action="{{ url_for('captures_delete') }}"
            onsubmit="return confirm('Delete this capture?')"
          >
            <input type="hidden" name="capture_ids" value="{{ capture.id }}" />
            <input type="hidden" name="next" value="{{ url_for('library') }}" />
            <button class="btn btn--danger" type="submit">Delete</button>
          </form>
        </div>
      </div>

      <div class="grid2">
        <div>
          <div class="panel inner">
            <div class="panel__title">Collections</div>
            <div class="panel__body">
              <form
                method="post"
                action="{{ url_for('capture_set_collections', capture_id=capture.id) }}"
              >
                <div class="col-list">
                  {% for c in collections %}
                    <label class="col-check">
                      <input
                        class="cap-check"
                        type="checkbox"
                        name="collections"
                        value="{{ c.id }}"
                        {% if c.has_it %}checked{% endif %}
                      />
                      {{ c.name }}
                    </label>
                  {% endfor %}
                </div>
                <div style="margin-top: 10px">
                  <button class="btn btn--primary" type="submit">Save</button>
                </div>
              </form>
            </div>
          </div>

          <div class="panel inner" style="margin-top: 10px">
            <div class="panel__title">Metadata</div>
            <div class="panel__body">
              <div class="kv">
                <div class="k">DOI</div>
                <div class="v">{{ capture.doi or "" }}</div>
              </div>
              <div class="kv">
                <div class="k">Year</div>
                <div class="v">{{ capture.year or "" }}</div>
              </div>
              <div class="kv">
                <div class="k">Container</div>
                <div class="v">{{ capture.container_title or "" }}</div>
              </div>

              {% if meta.published_date_raw %}
                <div class="kv">
                  <div class="k">Published</div>
                  <div class="v">{{ meta.published_date_raw }}</div>
                </div>
              {% endif %}

              {% if meta.keywords %}
                <div class="kv">
                  <div class="k">Keywords</div>
                  <div class="v">{{ meta.keywords | join(', ') }}</div>
                </div>
              {% endif %}
            </div>
          </div>
        </div>

        <div>
          <div class="panel inner">
            <div class="panel__title">Artifacts</div>
            <div class="panel__body">
              {% if artifact_links %}
                <ul class="clean">
                  {% for name, link in artifact_links.items() %}
                    <li>
                      <a
                        href="{{ link }}"
                        target="_blank"
                        rel="noopener noreferrer"
                        >{{ name }}</a
                      >
                    </li>
                  {% endfor %}
                </ul>
              {% else %}
                <div class="muted">No artifacts available.</div>
              {% endif %}
            </div>
          </div>

          {% if meta.meta %}
            <div class="panel inner" style="margin-top: 10px">
              <div class="panel__title">Raw head meta</div>
              <div class="panel__body">
                <pre class="pre">{{ meta.meta | tojson(indent=2) }}</pre>
              </div>
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
{% endblock %}
