{% load static %}
<!doctype html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <meta name="color-scheme" content="light dark"/>
  <title>Graph Â· Paperclip</title>

  <script>
  (function () {
    try {
      var KEY='pcTheme';
      var qs = new URLSearchParams(location.search);
      var paramTheme = qs.get('theme');
      var saved = localStorage.getItem(KEY);
      var prefersLight = window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches;
      var t = paramTheme || saved || (prefersLight ? 'light' : 'dark');
      document.documentElement.setAttribute('data-theme', t);
      try { localStorage.setItem(KEY, t); } catch(_) {}
      window.addEventListener('message', function (e) {
        var d = e && e.data; if (!d || d.type !== 'paperclip:set-theme') return;
        document.documentElement.setAttribute('data-theme', d.theme);
        try { localStorage.setItem(KEY, d.theme); } catch(_) {}
      });
      window.addEventListener('storage', function (e) {
        if (e.key === KEY && e.newValue) document.documentElement.setAttribute('data-theme', e.newValue);
      });
    } catch (_) {}
  })();
  </script>

  <link rel="stylesheet" href="{% static 'analysis/graph.css' %}?v=9">
  <style>
    html, body { height:100%; margin:0; }
    #graph-root { width:100%; height:100vh; }
  </style>
</head>
<body>
  <div id="graph-root"></div>
  <script>window.GRAPH_DATA = {{ data_json|safe }};</script>
  <script src="{% static 'analysis/graph.js' %}?v=9"></script>
  <script>
    window.addEventListener('load', function () {
      if (window.PCGraph && typeof window.PCGraph.bootGraphWithData === 'function') {
        window.PCGraph.bootGraphWithData(window.GRAPH_DATA);
      } else if (window.PCGraph && typeof window.PCGraph.bootGraph === 'function') {
        window.PCGraph.bootGraph();
      } else {
        var tries = 0, t = setInterval(function(){
          tries++;
          if (window.PCGraph && window.PCGraph.bootGraphWithData) {
            clearInterval(t); window.PCGraph.bootGraphWithData(window.GRAPH_DATA);
          } else if (tries > 40) { clearInterval(t); }
        }, 25);
      }
    });
  </script>
</body>
</html>
