{% extends "base.html" %}
{% load static staticv %}

{% block title %}Q&A Workspace · {{ collection.name }} · Paperclip{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% staticv 'captures/qaw.css' %}"/>

<div class="qaw-shell" id="pc-qaw" data-col-id="{{ collection.id }}" data-post-url="{% url 'collection_qaw' collection.id %}">
  <div class="qaw-toolbar">
    <div class="qaw-left">
      <a class="btn" href="/library/?col={{ collection.id }}">← Back to Library</a>
      <span class="qaw-crumb">Collection: <strong>{{ collection.name }}</strong></span>
    </div>
    <div class="qaw-right">
      <a class="btn" href="{% url 'collection_dashboard' collection.id %}">Dashboard</a>
      <a class="btn" href="/graph/" target="_blank" rel="noopener">Open Graph</a>
    </div>
  </div>

  <div class="qaw-body">
    <!-- Left: questions -->
    <aside class="qaw-questions">
      <div class="qaw-questions__head">
        <div class="title">Questions</div>
        <div class="actions">
          <button type="button" id="pc-q-new" class="btn btn--subtle">New</button>
          <button type="button" id="pc-q-monitor" class="btn btn--subtle">Monitor</button>
        </div>
      </div>
      <div class="qaw-questions__search">
        <input id="pc-q-filter" class="qaw-input" placeholder="Filter questions…">
      </div>
      <div id="pc-q-list" class="qaw-q-list" aria-live="polite"></div>
    </aside>

    <!-- Center -->
    <main class="qaw-main">
      <!-- Centered splash (first-run) -->
      <section id="pc-splash" class="qaw-splash" hidden>
        <div class="qaw-splash__inner">
          <h1 class="qaw-splash__title">What do you want to know about “{{ collection.name }}”?</h1>
          <div class="qaw-splash__search">
            <input id="pc-q-input-splash" class="qaw-ask__input" placeholder='Ask the collection…'>
            <button id="pc-q-run-splash" class="btn btn--primary">Ask</button>
          </div>
          <div class="qaw-splash__ideas">
            <button class="chip qaw-idea">What is the methodology in these papers?</button>
            <button class="chip qaw-idea">What do these papers agree on about X?</button>
            <button class="chip qaw-idea">Where do studies disagree?</button>
            <button class="chip qaw-idea">What are the gaps since 2022?</button>
          </div>
        </div>
      </section>

      <!-- Ask bar (sticky under toolbar) -->
      <div class="qaw-ask">
        <div class="qaw-ask__row">
          <input id="pc-q-input" class="qaw-ask__input" placeholder='Ask “{{ collection.name }}”… e.g., What do these papers agree on about X?'>
          <button id="pc-q-run" class="btn btn--primary">Run</button>
        </div>
        <div class="qaw-ask__meta">
          <span class="chip">Mode: <span id="pc-mode-chip">hybrid</span></span>
          <span class="chip">Limit: <span id="pc-limit-chip">30</span></span>
          <span class="chip">Scope: <span id="pc-scope-chip">all years</span></span>
        </div>
      </div>

      <!-- Answer -->
      <section id="pc-answer" class="qaw-answer">
        <div class="qaw-empty">Ask the collection to begin.</div>
      </section>
    </main>

    <!-- Right -->
    <aside class="qaw-side">
      <div class="panel">
        <div class="panel__title">Scope</div>
        <div class="row">
          <label>Years</label>
          <div class="pair">
            <input id="pc-year-min" class="qaw-input" inputmode="numeric" pattern="[0-9]*" placeholder="min">
            <span>–</span>
            <input id="pc-year-max" class="qaw-input" inputmode="numeric" pattern="[0-9]*" placeholder="max">
          </div>
        </div>
      </div>

      <div class="panel">
        <div class="panel__title">Method</div>
        <div class="seg">
          <button data-mode="text" class="seg__btn">Text</button>
          <button data-mode="semantic" class="seg__btn">Semantic</button>
          <button data-mode="hybrid" class="seg__btn seg__btn--active">Hybrid</button>
        </div>
        <div class="row">
          <label for="pc-limit">Max sources</label>
          <input id="pc-limit" class="qaw-input" type="number" min="5" max="100" step="1" value="{{ defaults.limit }}">
        </div>
        <div class="row">
          <button id="pc-trace-toggle" class="btn">Show reasoning trace</button>
        </div>
      </div>

      <div class="panel">
        <div class="panel__title">Provenance</div>
        <div class="muted">Snapshot—</div>
        <div class="muted">Sources are directly linked below the summary.</div>
      </div>
    </aside>
  </div>
</div>

<script type="module" src="{% staticv 'captures/qaw.js' %}"></script>
{% endblock %}
