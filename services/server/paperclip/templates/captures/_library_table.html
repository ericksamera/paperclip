{% load qs %}

<!-- Center: table -->
<main class="z-center">
  <table class="pc-table" id="pc-table" role="grid" aria-label="Library">
    <thead>
      <tr>
        <th class="pc-col-title" data-col="title">
          <a class="th-link" href="?{% qs_sort current_params 'title' sort dir 'asc' %}">
            Title{% if sort == 'title' %}<span class="th-arrow">{% if dir == 'asc' %}▲{% else %}▼{% endif %}</span>{% endif %}
          </a>
        </th>
        <th class="pc-col-tight" data-col="authors">Authors</th>
        <th class="pc-col-tight" data-col="year">
          <a class="th-link" href="?{% qs_sort current_params 'year' sort dir %}">
            Year{% if sort == 'year' %}<span class="th-arrow">{% if dir == 'asc' %}▲{% else %}▼{% endif %}</span>{% endif %}
          </a>
        </th>
        <th class="pc-col-tight" data-col="journal">
          <a class="th-link" href="?{% qs_sort current_params 'journal' sort dir %}">
            Journal{% if sort == 'journal' %}<span class="th-arrow">{% if dir == 'asc' %}▲{% else %}▼{% endif %}</span>{% endif %}
          </a>
        </th>
        <th class="pc-col-tight" data-col="doi">DOI</th>
        <th class="pc-col-tight" data-col="added">
          <a class="th-link" href="?{% qs_sort current_params 'created_at' sort dir 'desc' %}">
            Added{% if sort == 'created_at' or sort == 'added' %}<span class="th-arrow">{% if dir == 'asc' %}▲{% else %}▼{% endif %}</span>{% endif %}
          </a>
        </th>
        <th class="pc-col-tight" data-col="refs">Refs</th>
      </tr>
    </thead>
    <tbody id="pc-body">
      {% for r in rows %}
      <tr class="pc-row" draggable="true" data-id="{{ r.id }}" aria-selected="false"
          data-title="{{ r.title|escape }}"
          data-authors="{{ r.authors_intext|escape }}"
          data-year="{{ r.year }}"
          data-journal="{{ r.journal|escape }}"
          data-doi="{{ r.doi|escape }}"
          data-doi-url="{{ r.doi_url|default:'' }}"
          data-url="{{ r.url|escape }}"
          data-abstract="{{ r.abstract|escape }}"
          data-keywords="{{ r.keywords|join:', '|escape }}">
        <td class="pc-col-title" data-col="title">
          <a class="pc-title" href="{% url 'capture_view' r.id %}">{{ r.title|default:r.url|default:"(Untitled)" }}</a>
          {% if r.url %}
            <div class="pc-link"><a href="{{ r.url }}" target="_blank" rel="noreferrer">{{ r.site_label }}</a></div>
          {% endif %}
          {% if r.preview %}
            <div class="pc-snippet">{{ r.preview }}</div>
          {% endif %}
        </td>
        <td class="pc-col-tight" data-col="authors"><span class="pc-authors-inline" title="{{ r.authors_intext }}">{{ r.authors_intext }}</span></td>
        <td class="pc-col-tight" data-col="year">{{ r.year }}</td>
        <td class="pc-col-tight" data-col="journal" title="{{ r.journal }}">{{ r.journal_short }}</td>
        <td class="pc-col-tight" data-col="doi">{% if r.doi_url %}<a href="{{ r.doi_url }}" target="_blank" rel="noreferrer">{{ r.doi }}</a>{% endif %}</td>
        <td class="pc-col-tight" data-col="added">{{ r.added }}</td>
        <td class="pc-col-tight" data-col="refs">{{ r.refs }}</td>
      </tr>
      {% empty %}
        <tr>
          <td colspan="7" class="empty">
            {% if selected.q %}
              No results for “{{ selected.q }}”.
              <div class="mt-2" style="display:flex;gap:8px;flex-wrap:wrap">
                <a class="btn" href="?{% qs_update current_params q=None search=None page=None %}">Clear search</a>
                {% if selected.search != 'semantic' %}
                  <a class="btn" href="?{% qs_update current_params search='semantic' page=None %}">Try semantic</a>
                {% endif %}
                {% if selected.search != 'hybrid' %}
                  <a class="btn" href="?{% qs_update current_params search='hybrid' page=None %}">Try hybrid</a>
                {% endif %}
              </div>
            {% elif selected.col %}
              This collection is empty.
              <div class="mt-2">
                <a class="btn" href="?{% qs_update current_params col=None page=None %}">Back to All items</a>
              </div>
            {% else %}
              No items yet.
            {% endif %}
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</main>
